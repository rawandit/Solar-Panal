<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>حیسابکەری سیستەمی تاقە شمسی - رەوەند عمر عەوێنەیی</title>
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome for Icons -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
  <style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@300;400;500;600;700;800&display=swap');

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

:root {
  --primary-gold: #f59e0b;
  --primary-blue: #1e40af;
  --accent-orange: #ea580c;
  --surface-dark: #0f172a;
  --surface-card: #1e293b;
  --surface-light: #334155;
  --text-primary: #f8fafc;
  --text-secondary: #cbd5e1;
  --text-accent: #fbbf24;
  --shadow-glow: rgba(245, 158, 11, 0.3);
  --gradient-primary: linear-gradient(135deg, var(--primary-gold), var(--accent-orange));
  --gradient-surface: linear-gradient(145deg, var(--surface-card), var(--surface-light));
}

body {
  font-family: 'Noto Sans Arabic', 'Arial', sans-serif;
  background: var(--surface-dark);
  background-image: 
    radial-gradient(circle at 25% 25%, rgba(245, 158, 11, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 75% 75%, rgba(30, 64, 175, 0.1) 0%, transparent 50%),
    linear-gradient(180deg, var(--surface-dark) 0%, #020617 100%);
  min-height: 100vh;
  padding: 20px;
  color: var(--text-primary);
  position: relative;
  overflow-x: hidden;
}

body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: url('data:image/svg+xml,<svg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><g fill="%23f59e0b" fill-opacity="0.05"><circle cx="30" cy="30" r="1"/></g></svg>') repeat;
  pointer-events: none;
  z-index: -1;
}

.main-container {
  max-width: 1200px;
  margin: 0 auto;
  position: relative;
}

.glass-card {
  background: rgba(30, 41, 59, 0.8);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(245, 158, 11, 0.2);
  border-radius: 24px;
  box-shadow: 
    0 25px 50px rgba(0, 0, 0, 0.4),
    0 0 0 1px rgba(245, 158, 11, 0.1),
    inset 0 1px 0 rgba(248, 250, 252, 0.1);
  position: relative;
  overflow: hidden;
}

.glass-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, 
    transparent, 
    rgba(245, 158, 11, 0.1), 
    transparent);
  animation: shine 4s infinite;
}

@keyframes shine {
  0% { left: -100%; }
  50% { left: 100%; }
  100% { left: 100%; }
}

.hero-section {
  text-align: center;
  padding: 60px 40px;
  position: relative;
}

.solar-icon {
  width: 120px;
  height: 120px;
  margin: 0 auto 30px;
  background: var(--gradient-primary);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 
    0 20px 40px var(--shadow-glow),
    0 0 0 1px rgba(245, 158, 11, 0.3);
  position: relative;
  animation: float 6s ease-in-out infinite;
}

@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-10px); }
}

.solar-icon::before {
  content: '';
  position: absolute;
  width: 140px;
  height: 140px;
  border: 2px solid rgba(245, 158, 11, 0.3);
  border-radius: 50%;
  animation: pulse 3s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% { transform: scale(1); opacity: 0.5; }
  50% { transform: scale(1.1); opacity: 0.8; }
}

.solar-icon i {
  font-size: 48px;
  color: var(--surface-dark);
  animation: rotate 20s linear infinite;
}

@keyframes rotate {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.hero-title {
  font-size: 3.5rem;
  font-weight: 800;
  background: var(--gradient-primary);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 16px;
  text-shadow: 0 4px 8px rgba(245, 158, 11, 0.3);
}

.hero-subtitle {
  color: var(--text-secondary);
  font-size: 1.3rem;
  font-weight: 400;
  margin-bottom: 12px;
}

.developer-badge {
  display: inline-block;
  background: var(--gradient-surface);
  color: var(--text-accent);
  padding: 12px 24px;
  border-radius: 50px;
  font-weight: 600;
  border: 1px solid rgba(245, 158, 11, 0.3);
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
}

.controls-section {
  padding: 0 40px 40px;
}

.phase-selector {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-bottom: 40px;
}

.phase-btn {
  padding: 16px 32px;
  border: 2px solid rgba(245, 158, 11, 0.3);
  background: rgba(30, 41, 59, 0.5);
  color: var(--text-secondary);
  border-radius: 16px;
  font-weight: 600;
  font-size: 1.1rem;
  cursor: pointer;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
}

.phase-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: var(--gradient-primary);
  transition: left 0.4s;
}

.phase-btn span {
  position: relative;
  z-index: 1;
}

.phase-btn.active {
  background: var(--gradient-primary);
  border-color: var(--primary-gold);
  color: var(--surface-dark);
  transform: translateY(-2px);
  box-shadow: 0 12px 24px var(--shadow-glow);
}

.phase-btn:hover:not(.active) {
  border-color: var(--primary-gold);
  background: rgba(245, 158, 11, 0.1);
  transform: translateY(-1px);
}

.calculator-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 30px;
  margin-bottom: 30px;
}

.calc-form {
  background: var(--gradient-surface);
  border: 1px solid rgba(245, 158, 11, 0.2);
  border-radius: 20px;
  padding: 32px;
  position: relative;
  transition: all 0.4s ease;
}

.calc-form:hover {
  transform: translateY(-8px);
  box-shadow: 
    0 25px 50px rgba(0, 0, 0, 0.3),
    0 0 0 1px rgba(245, 158, 11, 0.3);
}

.form-header {
  display: flex;
  align-items: center;
  gap: 16px;
  margin-bottom: 24px;
  padding-bottom: 16px;
  border-bottom: 1px solid rgba(245, 158, 11, 0.2);
}

.form-icon {
  width: 50px;
  height: 50px;
  background: var(--gradient-primary);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--surface-dark);
  font-size: 20px;
  box-shadow: 0 8px 16px var(--shadow-glow);
}

.form-title {
  font-size: 1.4rem;
  font-weight: 700;
  color: var(--text-primary);
}

.input-group {
  margin-bottom: 20px;
}

.input-label {
  display: flex;
  align-items: center;
  gap: 8px;
  color: var(--text-accent);
  font-weight: 600;
  font-size: 0.95rem;
  margin-bottom: 8px;
}

.input-field {
  width: 100%;
  padding: 16px 20px;
  background: rgba(15, 23, 42, 0.8);
  border: 2px solid rgba(245, 158, 11, 0.2);
  border-radius: 12px;
  color: var(--text-primary);
  font-size: 1rem;
  font-weight: 500;
  transition: all 0.3s ease;
}

.input-field::placeholder {
  color: var(--text-secondary);
}

.input-field:focus {
  outline: none;
  border-color: var(--primary-gold);
  background: rgba(15, 23, 42, 0.9);
  box-shadow: 
    0 0 0 3px rgba(245, 158, 11, 0.2),
    0 8px 16px rgba(0, 0, 0, 0.2);
  transform: translateY(-1px);
}

.calc-button {
  width: 100%;
  padding: 18px;
  background: var(--gradient-primary);
  border: none;
  border-radius: 12px;
  color: var(--surface-dark);
  font-size: 1.1rem;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  box-shadow: 0 8px 16px var(--shadow-glow);
}

.calc-button::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, 
    transparent, 
    rgba(255, 255, 255, 0.2), 
    transparent);
  transition: left 0.6s;
}

.calc-button:hover::before {
  left: 100%;
}

.calc-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 24px var(--shadow-glow);
}

.calc-button:active {
  transform: translateY(0);
}

.results-section {
  background: var(--gradient-surface);
  border: 1px solid rgba(245, 158, 11, 0.3);
  border-radius: 20px;
  padding: 32px;
  margin-top: 30px;
  position: relative;
  animation: slideUp 0.6s ease-out;
}

@keyframes slideUp {
  from { 
    opacity: 0; 
    transform: translateY(40px); 
  }
  to { 
    opacity: 1; 
    transform: translateY(0); 
  }
}

.results-section::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: var(--gradient-primary);
  border-radius: 20px 20px 0 0;
}

.results-header {
  display: flex;
  align-items: center;
  gap: 16px;
  margin-bottom: 28px;
  padding-bottom: 16px;
  border-bottom: 1px solid rgba(245, 158, 11, 0.2);
}

.results-icon {
  width: 50px;
  height: 50px;
  background: var(--gradient-primary);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--surface-dark);
  font-size: 20px;
}

.results-title {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--text-primary);
}

.result-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 0;
  border-bottom: 1px solid rgba(245, 158, 11, 0.1);
  transition: all 0.3s ease;
}

.result-item:hover {
  background: rgba(245, 158, 11, 0.05);
  margin: 0 -16px;
  padding: 16px;
  border-radius: 8px;
}

.result-item:last-child {
  border-bottom: none;
}

.result-label {
  display: flex;
  align-items: center;
  gap: 12px;
  color: var(--text-secondary);
  font-weight: 500;
}

.result-value {
  color: var(--text-accent);
  font-weight: 700;
  font-size: 1.1rem;
}

.suggestions-box {
  background: rgba(245, 158, 11, 0.1);
  border: 1px solid rgba(245, 158, 11, 0.3);
  border-radius: 16px;
  padding: 24px;
  margin-top: 24px;
}

.suggestions-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 16px;
  color: var(--text-accent);
  font-weight: 700;
  font-size: 1.1rem;
}

.suggestion-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 0;
  color: var(--text-primary);
  font-weight: 500;
  transition: all 0.3s ease;
}

.suggestion-item:hover {
  color: var(--text-accent);
  padding-right: 8px;
}

.warning-box {
  background: rgba(234, 88, 12, 0.1);
  border: 1px solid rgba(234, 88, 12, 0.3);
  border-radius: 16px;
  padding: 24px;
  margin-top: 24px;
}

.warning-header {
  display: flex;
  align-items: center;
  gap: 12px;
  color: var(--accent-orange);
  font-weight: 700;
  font-size: 1.1rem;
}

.error-message {
  background: rgba(239, 68, 68, 0.1);
  border: 1px solid rgba(239, 68, 68, 0.3);
  border-radius: 12px;
  padding: 20px;
  color: #fca5a5;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 12px;
}

@media (max-width: 768px) {
  .main-container {
    padding: 10px;
  }
  
  .hero-section {
    padding: 40px 20px;
  }
  
  .hero-title {
    font-size: 2.5rem;
  }
  
  .solar-icon {
    width: 100px;
    height: 100px;
  }
  
  .solar-icon i {
    font-size: 40px;
  }
  
  .controls-section {
    padding: 0 20px 40px;
  }
  
  .calculator-grid {
    grid-template-columns: 1fr;
    gap: 20px;
  }
  
  .phase-selector {
    flex-direction: column;
    align-items: center;
    gap: 12px;
  }
  
  .phase-btn {
    width: 200px;
  }
  
  .calc-form {
    padding: 24px;
  }
}

@media (max-width: 480px) {
  .hero-title {
    font-size: 2rem;
  }
  
  .hero-subtitle {
    font-size: 1.1rem;
  }
  
  .calc-form {
    padding: 20px;
  }
  
  .results-section {
    padding: 24px;
  }
}
  </style>
</head>
<body>
  <div class="main-container">
    <div class="glass-card">
      <!-- Hero Section -->
      <div class="hero-section">
        <div class="solar-icon">
          <i class="fas fa-sun"></i>
        </div>
        <h1 class="hero-title">حیسابکەری تاقە شمسی</h1>
        <p class="hero-subtitle">حیساباتی پیشەیی و ئاسان بۆ دیزاینی سیستەمی کارەبای خۆر</p>
        <div class="developer-badge">
          <i class="fas fa-code me-2"></i>
          دروستکراو لەلایەن: رەوەند عمر عەوێنەیی
        </div>
      </div>

      <!-- Controls Section -->
      <div class="controls-section">
        <!-- Phase Selection -->
        <div class="phase-selector">
          <button class="phase-btn active" data-phase="single">
            <span><i class="fas fa-bolt me-2"></i>سینگل فەیز</span>
          </button>
          <button class="phase-btn" data-phase="three">
            <span><i class="fas fa-plug-circle-bolt me-2"></i>سێ فەیز</span>
          </button>
        </div>

        <!-- Calculator Forms -->
        <div class="calculator-grid single-phase-forms">
          <!-- Panel Count Calculator -->
          <div class="calc-form">
            <div class="form-header">
              <div class="form-icon">
                <i class="fas fa-solar-panel"></i>
              </div>
              <h3 class="form-title">حیسابکردن بە ژمارەی پانێڵ</h3>
            </div>
            <div class="input-group">
              <label class="input-label">
                <i class="fas fa-hashtag"></i>
                ژمارەی پانێڵەکان
              </label>
              <input type="number" class="input-field" id="panelCount" placeholder="ژمارەی پانێڵەکان داخل بکە">
            </div>
            <div class="input-group">
              <label class="input-label">
                <i class="fas fa-bolt"></i>
                هێزی پانێڵ (وات)
              </label>
              <input type="number" class="input-field" id="panelWatt" placeholder="هێزی پانێڵ بە وات داخل بکە">
            </div>
            <button class="calc-button" onclick="calculateByPanels()">
              <i class="fas fa-calculator me-2"></i>
              حیسابکردن
            </button>
          </div>

          <!-- Amperage Calculator -->
          <div class="calc-form">
            <div class="form-header">
              <div class="form-icon">
                <i class="fas fa-tachometer-alt"></i>
              </div>
              <h3 class="form-title">حیسابکردن بە ئەمپێر</h3>
            </div>
            <div class="input-group">
              <label class="input-label">
                <i class="fas fa-tachometer-alt"></i>
                ئەمپێر (A)
              </label>
              <input type="number" class="input-field" id="amps" placeholder="ئەمپێر داخل بکە">
            </div>
            <div class="input-group">
              <label class="input-label">
                <i class="fas fa-bolt"></i>
                هێزی پانێڵ (وات)
              </label>
              <input type="number" class="input-field" id="panelWattAmp" placeholder="هێزی پانێڵ بە وات داخل بکە">
            </div>
            <button class="calc-button" onclick="calculateByAmps()">
              <i class="fas fa-calculator me-2"></i>
              حیسابکردن
            </button>
          </div>
        </div>

        <!-- Three Phase Forms -->
        <div class="calculator-grid three-phase-forms d-none">
          <!-- Three Phase Panel Calculator -->
          <div class="calc-form">
            <div class="form-header">
              <div class="form-icon">
                <i class="fas fa-solar-panel"></i>
              </div>
              <h3 class="form-title">حیسابکردن بە ژمارەی پانێڵ (سێ فەیز)</h3>
            </div>
            <div class="input-group">
              <label class="input-label">
                <i class="fas fa-hashtag"></i>
                ژمارەی پانێڵەکان
              </label>
              <input type="number" class="input-field" id="threePhasePanelCount" placeholder="ژمارەی پانێڵەکان داخل بکە">
            </div>
            <div class="input-group">
              <label class="input-label">
                <i class="fas fa-bolt"></i>
                هێزی پانێڵ (وات)
              </label>
              <input type="number" class="input-field" id="threePhasePanelWatt" placeholder="هێزی پانێڵ بە وات داخل بکە">
            </div>
            <button class="calc-button" onclick="calculateThreePhaseByPanels()">
              <i class="fas fa-calculator me-2"></i>
              حیسابکردن
            </button>
          </div>

          <!-- Three Phase Amperage Calculator -->
          <div class="calc-form">
            <div class="form-header">
              <div class="form-icon">
                <i class="fas fa-plug-circle-bolt"></i>
              </div>
              <h3 class="form-title">حیسابکردن بە ئەمپێر (سێ فەیز)</h3>
            </div>
            <div class="input-group">
              <label class="input-label">
                <i class="fas fa-tachometer-alt"></i>
                ئەمپێر (A)
              </label>
              <input type="number" class="input-field" id="threePhaseAmps" placeholder="ئەمپێر داخل بکە">
            </div>
            <div class="input-group">
              <label class="input-label">
                <i class="fas fa-bolt"></i>
                هێزی پانێڵ (وات)
              </label>
              <input type="number" class="input-field" id="threePhasePanelWattAmp" placeholder="هێزی پانێڵ بە وات داخل بکە">
            </div>
            <button class="calc-button" onclick="calculateThreePhaseByAmps()">
              <i class="fas fa-calculator me-2"></i>
              حیسابکردن
            </button>
          </div>
        </div>

        <!-- Results Section -->
        <div id="result" class="d-none"></div>
      </div>
    </div>

    <!-- PDF Report Modal -->
    <div class="modal fade" id="pdfModal" tabindex="-1" aria-labelledby="pdfModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content" style="background: var(--surface-card); border: 1px solid rgba(245, 158, 11, 0.3);">
          <div class="modal-header" style="border-bottom: 1px solid rgba(245, 158, 11, 0.2);">
            <h5 class="modal-title" id="pdfModalLabel" style="color: var(--text-primary);">
              <i class="fas fa-file-pdf me-2" style="color: var(--primary-gold);"></i>
              راپۆرتی سیستەمی تاقە شمسی
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="filter: invert(1);"></button>
          </div>
          <div class="modal-body">
            <div id="pdfPreview" style="background: white; border-radius: 8px; overflow: hidden;">
              <!-- PDF Preview Content will be inserted here -->
            </div>
          </div>
          <div class="modal-footer" style="border-top: 1px solid rgba(245, 158, 11, 0.2);">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="background: var(--surface-light); border: none; color: var(--text-primary);">
              <i class="fas fa-times me-2"></i>داخستن
            </button>
            <button type="button" class="btn" id="downloadPdfBtn" style="background: var(--gradient-primary); border: none; color: var(--surface-dark); font-weight: 600;">
              <i class="fas fa-download me-2"></i>داگرتنی PDF
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- jsPDF Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- html2canvas for PDF generation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    let currentResultData = null;

    function generatePDFContent(resultData) {
      const currentDate = new Date().toLocaleDateString('ku-Arab-IQ', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });

      return `
        <div style="font-family: 'Noto Sans Arabic', Arial, sans-serif; direction: rtl; padding: 40px; background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); min-height: 800px;">
          <!-- Header -->
          <div style="text-align: center; margin-bottom: 40px; padding: 30px; background: linear-gradient(135deg, #1e40af, #3b82f6); border-radius: 20px; color: white; box-shadow: 0 10px 30px rgba(30, 64, 175, 0.3);">
            <div style="width: 80px; height: 80px; margin: 0 auto 20px; background: linear-gradient(135deg, #f59e0b, #ea580c); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 20px rgba(245, 158, 11, 0.4);">
              <i class="fas fa-sun" style="font-size: 32px; color: white;"></i>
            </div>
            <h1 style="font-size: 2.5rem; font-weight: 800; margin-bottom: 10px; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">راپۆرتی سیستەمی تاقە شمسی</h1>
            <p style="font-size: 1.2rem; opacity: 0.9; margin-bottom: 15px;">حیساباتی پیشەیی و تەکنیکی</p>
            <div style="background: rgba(255,255,255,0.2); padding: 10px 20px; border-radius: 25px; display: inline-block;">
              <span style="font-weight: 600;">دروستکراو لەلایەن: رەوەند عمر عەوێنەیی</span>
            </div>
          </div>

          <!-- Report Info -->
          <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 30px; border-right: 5px solid #f59e0b; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px;">
              <div>
                <h3 style="color: #1e40af; font-weight: 700; font-size: 1.3rem; margin-bottom: 5px;">
                  <i class="fas fa-info-circle" style="color: #f59e0b; margin-left: 8px;"></i>
                  زانیاری راپۆرت
                </h3>
                <p style="color: #64748b; margin: 0; font-size: 1rem;">جۆری سیستەم: <strong style="color: #1e40af;">${resultData.systemType}</strong></p>
              </div>
              <div style="text-align: left;">
                <p style="color: #64748b; margin: 0; font-size: 0.95rem;">بەروار:</p>
                <p style="color: #1e40af; font-weight: 600; margin: 5px 0 0 0; font-size: 1.1rem;">${currentDate}</p>
              </div>
            </div>
          </div>

          <!-- Input Parameters -->
          <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
            <h3 style="color: #1e40af; font-weight: 700; font-size: 1.3rem; margin-bottom: 20px; border-bottom: 2px solid #f59e0b; padding-bottom: 10px;">
              <i class="fas fa-keyboard" style="color: #f59e0b; margin-left: 8px;"></i>
              پارامەتەرەکانی داخڵکراو
            </h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
              ${resultData.inputs.map(input => `
                <div style="background: linear-gradient(135deg, #f8fafc, #f1f5f9); padding: 20px; border-radius: 12px; border-right: 4px solid #3b82f6;">
                  <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                    <i class="${input.icon}" style="color: #f59e0b; font-size: 1.1rem;"></i>
                    <span style="color: #475569; font-weight: 600; font-size: 0.95rem;">${input.label}</span>
                  </div>
                  <p style="color: #1e40af; font-weight: 700; font-size: 1.4rem; margin: 0;">${input.value}</p>
                </div>
              `).join('')}
            </div>
          </div>

          <!-- Results -->
          <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
            <h3 style="color: #1e40af; font-weight: 700; font-size: 1.3rem; margin-bottom: 20px; border-bottom: 2px solid #f59e0b; padding-bottom: 10px;">
              <i class="fas fa-chart-line" style="color: #f59e0b; margin-left: 8px;"></i>
              ئەنجامەکانی حیسابکردن
            </h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
              ${resultData.results.map((result, index) => `
                <div style="background: linear-gradient(135deg, ${index % 2 === 0 ? '#fef3c7, #fbbf24' : '#dbeafe, #3b82f6'}); padding: 25px; border-radius: 15px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); position: relative; overflow: hidden;">
                  <div style="position: absolute; top: -20px; left: -20px; width: 60px; height: 60px; background: rgba(255,255,255,0.2); border-radius: 50%;"></div>
                  <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px; position: relative; z-index: 1;">
                    <div style="width: 40px; height: 40px; background: rgba(255,255,255,0.3); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                      <i class="${result.icon}" style="color: white; font-size: 1.2rem;"></i>
                    </div>
                    <span style="color: white; font-weight: 600; font-size: 1rem; text-shadow: 0 1px 2px rgba(0,0,0,0.2);">${result.label}</span>
                  </div>
                  <p style="color: white; font-weight: 800; font-size: 2rem; margin: 0; text-shadow: 0 2px 4px rgba(0,0,0,0.3); position: relative; z-index: 1;">${result.value}</p>
                </div>
              `).join('')}
            </div>
          </div>

          ${resultData.suggestions ? `
          <!-- Suggestions -->
          <div style="background: linear-gradient(135deg, #fef3c7, #fbbf24); padding: 25px; border-radius: 15px; margin-bottom: 30px; border: 2px solid #f59e0b; box-shadow: 0 5px 15px rgba(245, 158, 11, 0.2);">
            <h3 style="color: #92400e; font-weight: 700; font-size: 1.3rem; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
              <div style="width: 35px; height: 35px; background: #f59e0b; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-lightbulb" style="color: white; font-size: 1rem;"></i>
              </div>
              پێشنیارەکانی ئینڤێرتەر
            </h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
              ${resultData.suggestions.map(suggestion => `
                <div style="background: rgba(255,255,255,0.8); padding: 15px; border-radius: 10px; display: flex; align-items: center; gap: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                  <i class="fas fa-check-circle" style="color: #16a34a; font-size: 1.1rem;"></i>
                  <span style="color: #374151; font-weight: 600;">${suggestion}</span>
                </div>
              `).join('')}
            </div>
          </div>
          ` : ''}

          <!-- Footer -->
          <div style="background: linear-gradient(135deg, #374151, #4b5563); padding: 25px; border-radius: 15px; text-align: center; color: white; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px;">
              <div>
                <h4 style="margin: 0 0 5px 0; font-weight: 700; color: #f59e0b;">حیسابکەری سیستەمی تاقە شمسی</h4>
                <p style="margin: 0; opacity: 0.8; font-size: 0.9rem;">دروستکراو لەلایەن رەوەند عمر عەوێنەیی</p>
              </div>
              <div style="text-align: left;">
                <p style="margin: 0; opacity: 0.8; font-size: 0.9rem;">ئامرازی پیشەیی بۆ حیسابکردنی سیستەمی خۆر</p>
                <p style="margin: 5px 0 0 0; color: #f59e0b; font-weight: 600;">www.solar-calculator.com</p>
              </div>
            </div>
            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(245, 158, 11, 0.3);">
              <p style="margin: 0; opacity: 0.7; font-size: 0.85rem;">
                <i class="fas fa-info-circle" style="margin-left: 5px;"></i>
                ئەم راپۆرتە لەسەر بنەمای حیساباتی ستاندارد و پڕاکتیسی پیشەیی دروستکراوە
              </p>
            </div>
          </div>
        </div>
      `;
    }

    function showPDFModal(resultData) {
      currentResultData = resultData;
      const pdfContent = generatePDFContent(resultData);
      document.getElementById('pdfPreview').innerHTML = pdfContent;
      
      const modal = new bootstrap.Modal(document.getElementById('pdfModal'));
      modal.show();
    }

    function downloadPDF() {
      if (!currentResultData) return;

      const element = document.getElementById('pdfPreview');
      const opt = {
        margin: 0,
        filename: `تاقە-شمسی-راپۆرت-${new Date().toISOString().split('T')[0]}.pdf`,
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { 
          scale: 2,
          useCORS: true,
          allowTaint: true,
          backgroundColor: '#ffffff'
        },
        jsPDF: { 
          unit: 'mm', 
          format: 'a4', 
          orientation: 'portrait',
          putOnlyUsedFonts: true
        }
      };

      // Show loading state
      const downloadBtn = document.getElementById('downloadPdfBtn');
      const originalText = downloadBtn.innerHTML;
      downloadBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>دروستکردن...';
      downloadBtn.disabled = true;

      html2canvas(element, {
        scale: 2,
        useCORS: true,
        allowTaint: true,
        backgroundColor: '#ffffff',
        width: element.offsetWidth,
        height: element.offsetHeight
      }).then(canvas => {
        const imgData = canvas.toDataURL('image/jpeg', 0.95);
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF('p', 'mm', 'a4');
        
        const imgWidth = 210;
        const pageHeight = 295;
        const imgHeight = (canvas.height * imgWidth) / canvas.width;
        let heightLeft = imgHeight;
        let position = 0;

        pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
        heightLeft -= pageHeight;

        while (heightLeft >= 0) {
          position = heightLeft - imgHeight;
          pdf.addPage();
          pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
          heightLeft -= pageHeight;
        }

        pdf.save(`تاقە-شمسی-راپۆرت-${new Date().toISOString().split('T')[0]}.pdf`);
        
        // Reset button
        downloadBtn.innerHTML = originalText;
        downloadBtn.disabled = false;
      }).catch(error => {
        console.error('Error generating PDF:', error);
        downloadBtn.innerHTML = originalText;
        downloadBtn.disabled = false;
        alert('هەڵەیەک ڕوویدا لە دروستکردنی PDF');
      });
    }

    // Add event listener for download button
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('downloadPdfBtn').addEventListener('click', downloadPDF);
    });

    const inverterSizes = [3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30];

    // Phase switching functionality
    document.querySelectorAll('.phase-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        // Remove active class from all buttons
        document.querySelectorAll('.phase-btn').forEach(b => b.classList.remove('active'));
        // Add active class to clicked button
        this.classList.add('active');
        
        const phase = this.dataset.phase;
        if (phase === 'single') {
          document.querySelector('.single-phase-forms').classList.remove('d-none');
          document.querySelector('.three-phase-forms').classList.add('d-none');
        } else {
          document.querySelector('.single-phase-forms').classList.add('d-none');
          document.querySelector('.three-phase-forms').classList.remove('d-none');
        }
        
        // Clear results
        document.getElementById("result").innerHTML = '';
        document.getElementById("result").classList.add("d-none");
      });
    });

    function suggestInverters(totalKW) {
      let suggestions = [];
      for (let size of inverterSizes) {
        let count = Math.round(totalKW / size);
        if (count > 0 && count <= 3 && Math.abs(count * size - totalKW) <= 1) {
          suggestions.push(`${count} ئینڤێرتەری ${size} kW`);
        }
      }
      for (let size of inverterSizes) {
        for (let count = 1; count <= 3; count++) {
          let total = count * size;
          if (Math.abs(total - totalKW) <= 1 && total >= totalKW) {
            suggestions.push(`${count} ئینڤێرتەری ${size} kW`);
          }
        }
      }
      suggestions = [...new Set(suggestions)];

      return suggestions.length > 0
        ? `<div class="suggestions-box">
             <div class="suggestions-header">
               <i class="fas fa-lightbulb"></i>
               پێشنیارەکان بۆ ${totalKW.toFixed(2)} kW:
             </div>
             ${suggestions.map(s => `
               <div class="suggestion-item">
                 <i class="fas fa-check-circle" style="color: var(--primary-gold);"></i>
                 ${s}
               </div>
             `).join('')}
           </div>`
        : `<div class="warning-box">
             <div class="warning-header">
               <i class="fas fa-exclamation-triangle"></i>
               هیچ ئینڤێرتەرێک لە لیستی قەبارەکاندا گونجاو نییە بۆ ${totalKW.toFixed(2)} kW.
             </div>
           </div>`;
    }

    function showResults(html, resultData = null) {
      document.getElementById("result").innerHTML = html;
      document.getElementById("result").classList.remove("d-none");
      
      // Add PDF button if we have result data
      if (resultData) {
        const pdfButton = `
          <div style="text-align: center; margin-top: 20px;">
            <button class="calc-button" onclick="showPDFModal(currentResultData)" style="width: auto; padding: 12px 24px;">
              <i class="fas fa-file-pdf me-2"></i>
              دروستکردنی راپۆرتی PDF
            </button>
          </div>
        `;
        document.getElementById("result").innerHTML += pdfButton;
        currentResultData = resultData;
      }
      
      setTimeout(() => {
        document.getElementById("result").scrollIntoView({ 
          behavior: 'smooth', 
          block: 'nearest' 
        });
      }, 100);
    }

    function calculateByPanels() {
      let panelCount = parseFloat(document.getElementById("panelCount").value);
      let panelWatt = parseFloat(document.getElementById("panelWatt").value);

      if (isNaN(panelCount) || isNaN(panelWatt) || panelCount <= 0 || panelWatt <= 0) {
        showResults(`
          <div class="error-message">
            <i class="fas fa-exclamation-triangle"></i>
            تکایە ژمارەیەکی دروست و نەرێ داخل بکە!
          </div>
        `);
        return;
      }

      let totalWatt = panelCount * panelWatt;
      let totalKW = totalWatt / 1000;
      let amps = (totalWatt / 230) * 0.8;
      let inverterSuggestion = suggestInverters(totalKW);

      const resultData = {
        systemType: 'سینگل فەیز',
        inputs: [
          { label: 'ژمارەی پانێڵەکان', value: `${panelCount}`, icon: 'fas fa-hashtag' },
          { label: 'هێزی پانێڵ', value: `${panelWatt} وات`, icon: 'fas fa-bolt' }
        ],
        results: [
          { label: 'هێزی ئینڤێرتەر', value: `${totalKW.toFixed(2)} kW`, icon: 'fas fa-microchip' },
          { label: 'ئەمپێر', value: `${amps.toFixed(2)} A`, icon: 'fas fa-tachometer-alt' }
        ],
        suggestions: getSuggestionsList(totalKW)
      };

      showResults(`
        <div class="results-section">
          <div class="results-header">
            <div class="results-icon">
              <i class="fas fa-check-circle"></i>
            </div>
            <h3 class="results-title">ئەنجامەکانی سینگل فەیز</h3>
          </div>
          <div class="result-item">
            <div class="result-label">
              <i class="fas fa-microchip"></i>
              هێزی ئینڤێرتەر
            </div>
            <div class="result-value">${totalKW.toFixed(2)} kW</div>
          </div>
          <div class="result-item">
            <div class="result-label">
              <i class="fas fa-tachometer-alt"></i>
              ئەمپێر
            </div>
            <div class="result-value">${amps.toFixed(2)} A</div>
          </div>
          ${inverterSuggestion}
        </div>
      `, resultData);
    }

    function getSuggestionsList(totalKW) {
      let suggestions = [];
      for (let size of inverterSizes) {
        let count = Math.round(totalKW / size);
        if (count > 0 && count <= 3 && Math.abs(count * size - totalKW) <= 1) {
          suggestions.push(`${count} ئینڤێرتەری ${size} kW`);
        }
      }
      for (let size of inverterSizes) {
        for (let count = 1; count <= 3; count++) {
          let total = count * size;
          if (Math.abs(total - totalKW) <= 1 && total >= totalKW) {
            suggestions.push(`${count} ئینڤێرتەری ${size} kW`);
          }
        }
      }
      return [...new Set(suggestions)];
    }

    function calculateByAmps() {
      let amps = parseFloat(document.getElementById("amps").value);
      let panelWatt = parseFloat(document.getElementById("panelWattAmp").value);

      if (isNaN(amps) || isNaN(panelWatt) || amps <= 0 || panelWatt <= 0) {
        showResults(`
          <div class="error-message">
            <i class="fas fa-exclamation-triangle"></i>
            تکایە ژمارەیەکی دروست و نەرێ داخل بکە!
          </div>
        `);
        return;
      }

      let totalWatt = (amps / 0.8) * 230;
      let totalKW = totalWatt / 1000;
      let panelCount = Math.ceil(totalWatt / panelWatt);
      let inverterSuggestion = suggestInverters(totalKW);

      const resultData = {
        systemType: 'سینگل فەیز',
        inputs: [
          { label: 'ئەمپێر', value: `${amps} A`, icon: 'fas fa-tachometer-alt' },
          { label: 'هێزی پانێڵ', value: `${panelWatt} وات`, icon: 'fas fa-bolt' }
        ],
        results: [
          { label: 'ژمارەی پانێڵەکان', value: `${panelCount}`, icon: 'fas fa-solar-panel' },
          { label: 'هێزی ئینڤێرتەر', value: `${totalKW.toFixed(2)} kW`, icon: 'fas fa-microchip' }
        ],
        suggestions: getSuggestionsList(totalKW)
      };

      showResults(`
        <div class="results-section">
          <div class="results-header">
            <div class="results-icon">
              <i class="fas fa-check-circle"></i>
            </div>
            <h3 class="results-title">ئەنجامەکانی سینگل فەیز</h3>
          </div>
          <div class="result-item">
            <div class="result-label">
              <i class="fas fa-solar-panel"></i>
              ژمارەی پانێڵەکان
            </div>
            <div class="result-value">${panelCount}</div>
          </div>
          <div class="result-item">
            <div class="result-label">
              <i class="fas fa-microchip"></i>
              هێزی ئینڤێرتەر
            </div>
            <div class="result-value">${totalKW.toFixed(2)} kW</div>
          </div>
          ${inverterSuggestion}
        </div>
      `, resultData);
    }
      let panelWatt = parseFloat(document.getElementById("panelWattAmp").value);

      if (isNaN(amps) || isNaN(panelWatt) || amps <= 0 || panelWatt <= 0) {
        showResults(`
          <div class="error-message">
            <i class="fas fa-exclamation-triangle"></i>
            تکایە ژمارەیەکی دروست و نەرێ داخل بکە!
          </div>
        `);
        return;
      }

      let totalWatt = (amps / 0.8) * 230;
      let totalKW = totalWatt / 1000;
      let panelCount = Math.ceil(totalWatt / panelWatt);
      let inverterSuggestion = suggestInverters(totalKW);

      showResults(`
        <div class="results-section">
          <div class="results-header">
            <div class="results-icon">
              <i class="fas fa-check-circle"></i>
            </div>
            <h3 class="results-title">ئەنجامەکانی سینگل فەیز</h3>
          </div>
          <div class="result-item">
            <div class="result-label">
              <i class="fas fa-solar-panel"></i>
              ژمارەی پانێڵەکان
            </div>
            <div class="result-value">${panelCount}</div>
          </div>
          <div class="result-item">
            <div class="result-label">
              <i class="fas fa-microchip"></i>
              هێزی ئینڤێرتەر
            </div>
            <div class="result-value">${totalKW.toFixed(2)} kW</div>
          </div>
          ${inverterSuggestion}
        </div>
      `);
    }

    function calculateThreePhaseByPanels() {
      let panelCount = parseFloat(document.getElementById("threePhasePanelCount").value);
      let panelWatt = parseFloat(document.getElementById("threePhasePanelWatt").value);

      if (isNaN(panelCount) || isNaN(panelWatt) || panelCount <= 0 || panelWatt <= 0) {
        showResults(`
          <div class="error-message">
            <i class="fas fa-exclamation-triangle"></i>
            تکایە ژمارەیەکی دروست و نەرێ داخل بکە!
          </div>
        `);
        return;
      }

      let inv = (panelCount * panelWatt) / 1000;
      let pr = inv * 0.7;
      let ampsSinglePhase = (pr * 1000) / (400 * 1.732 * 0.8);
      let ampsTotal = ampsSinglePhase * 3;
      let inverterSuggestion = suggestInverters(inv);

      showResults(`
        <div class="results-section">
          <div class="results-header">
            <div class="results-icon">
              <i class="fas fa-check-circle"></i>
            </div>
            <h3 class="results-title">ئەنجامەکانی سێ فەیز</h3>
          </div>
          <div class="result-item">
            <div class="result-label">
              <i class="fas fa-microchip"></i>
              هێزی ئینڤێرتەر
            </div>
            <div class="result-value">${inv.toFixed(2)} kW</div>
          </div>
          <div class="result-item">
            <div class="result-label">
              <i class="fas fa-tachometer-alt"></i>
              ئەمپێر بۆ یەک فەیز
            </div>
            <div class="result-value">${ampsSinglePhase.toFixed(2)} A</div>
          </div>
          <div class="result-item">
            <div class="result-label">
              <i class="fas fa-tachometer-alt"></i>
              ئەمپێر بۆ هەر سێ فەیز
            </div>
            <div class="result-value">${ampsTotal.toFixed(2)} A</div>
          </div>
          <div class="result-item">
            <div class="result-label">
              <i class="fas fa-plug-circle-bolt"></i>
              هێزی پێویست
            </div>
            <div class="result-value">${pr.toFixed(2)} kW</div>
          </div>
          ${inverterSuggestion}
        </div>
      `);
    }

    function calculateThreePhaseByAmps() {
      let ampsTotal = parseFloat(document.getElementById("threePhaseAmps").value);
      let panelWatt = parseFloat(document.getElementById("threePhasePanelWattAmp").value);

      if (isNaN(ampsTotal) || isNaN(panelWatt) || ampsTotal <= 0 || panelWatt <= 0) {
        showResults(`
          <div class="error-message">
            <i class="fas fa-exclamation-triangle"></i>
            تکایە ژمارەیەکی دروست و نەرێ داخل بکە!
          </div>
        `);
        return;
      }

      let ampsSinglePhase = ampsTotal / 3;
      let pr = (400 * ampsSinglePhase * 1.732 * 0.8) / 1000;
      let inv = pr / 0.7;
      let panelCount = Math.ceil((inv * 1000) / panelWatt);
      let inverterSuggestion = suggestInverters(inv);

      showResults(`
        <div class="results-section">
          <div class="results-header">
            <div class="results-icon">
              <i class="fas fa-check-circle"></i>
            </div>
            <h3 class="results-title">ئەنجامەکانی سێ فەیز</h3>
          </div>
          <div class="result-item">
            <div class="result-label">
              <i class="fas fa-solar-panel"></i>
              ژمارەی پانێڵەکان
            </div>
            <div class="result-value">${panelCount}</div>
          </div>
          <div class="result-item">
            <div class="result-label">
              <i class="fas fa-microchip"></i>
              هێزی ئینڤێرتەر
            </div>
            <div class="result-value">${inv.toFixed(2)} kW</div>
          </div>
          <div class="result-item">
            <div class="result-label">
              <i class="fas fa-tachometer-alt"></i>
              ئەمپێر بۆ یەک فەیز
            </div>
            <div class="result-value">${ampsSinglePhase.toFixed(2)} A</div>
          </div>
          <div class="result-item">
            <div class="result-label">
              <i class="fas fa-tachometer-alt"></i>
              ئەمپێر بۆ هەر سێ فەیز
            </div>
            <div class="result-value">${ampsTotal.toFixed(2)} A</div>
          </div>
          <div class="result-item">
            <div class="result-label">
              <i class="fas fa-plug-circle-bolt"></i>
              هێزی پێویست
            </div>
            <div class="result-value">${pr.toFixed(2)} kW</div>
          </div>
          ${inverterSuggestion}
        </div>
      `);
    }

    // Enter key functionality
    document.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        const activeElement = document.activeElement;
        if (activeElement.closest('.single-phase-forms')) {
          if (activeElement.closest('.calc-form:first-child')) {
            calculateByPanels();
          } else {
            calculateByAmps();
          }
        } else if (activeElement.closest('.three-phase-forms')) {
          if (activeElement.closest('.calc-form:first-child')) {
            calculateThreePhaseByPanels();
          } else {
            calculateThreePhaseByAmps();
          }
        }
      }
    });
  </script>
</body>
</html>
