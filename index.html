<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="pageTitle">حیساباتی سیستەمی خۆر</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      font-family: 'Amiri', Arial, sans-serif;
      background: linear-gradient(135deg, #1e3c72, #2a5298);
      margin: 0;
      padding: 40px;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .container {
      max-width: 900px;
      background: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s ease;
    }

    .container:hover {
      transform: translateY(-5px);
    }

    .main-title {
      text-align: center;
      color: #1e3c72;
      font-size: 2.5em;
      margin-bottom: 30px;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
    }

    .form-section {
      margin-bottom: 40px;
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
    }

    .form-title {
      font-size: 1.8em;
      color: #2a5298;
      margin-bottom: 20px;
    }

    .input-group {
      margin-bottom: 20px;
    }

    .input-label {
      display: block;
      font-size: 1.2em;
      color: #333;
      margin-bottom: 8px;
      font-weight: bold;
    }

    .input-field {
      width: 100%;
      padding: 12px;
      font-size: 1em;
      border: 2px solid #ccc;
      border-radius: 8px;
      box-sizing: border-box;
      transition: border-color 0.3s ease;
    }

    .input-field:focus {
      border-color: #2a5298;
      outline: none;
    }

    .calculate-btn, .download-btn {
      display: block;
      width: 100%;
      padding: 15px;
      background: linear-gradient(90deg, #28a745, #34c759);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1.2em;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.2s ease;
    }

    .calculate-btn:hover, .download-btn:hover {
      background: linear-gradient(90deg, #218838, #2ba64b);
      transform: translateY(-2px);
    }

    .results-section {
      margin-top: 30px;
      background: #e9ecef;
      padding: 20px;
      border-radius: 10px;
    }

    .results-header {
      display: flex;
      align-items: center;
      background: #2a5298;
      color: white;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
    }

    .results-icon {
      margin-left: 10px;
    }

    .results-title {
      margin: 0;
      font-size: 1.5em;
    }

    .result-item {
      display: flex;
      justify-content: space-between;
      padding: 12px;
      border-bottom: 1px solid #dee2e6;
      font-size: 1.1em;
    }

    .result-label {
      font-weight: bold;
      color: #333;
    }

    .result-value {
      color: #2a5298;
      font-weight: 500;
    }

    .suggestions-box, .warning-box {
      margin-top: 15px;
      padding: 15px;
      border-radius: 8px;
    }

    .suggestions-box {
      background: #e6f4ea;
    }

    .suggestions-header {
      font-weight: bold;
      color: #28a745;
      font-size: 1.2em;
    }

    .suggestion-item {
      margin: 8px 0;
      font-size: 1.1em;
    }

    .warning-box {
      background: #fff3cd;
    }

    .warning-header {
      font-weight: bold;
      color: #856404;
      font-size: 1.2em;
    }

    .error-message {
      background: #f8d7da;
      color: #721c24;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      font-size: 1.1em;
    }

    .download-section {
      margin-top: 30px;
      text-align: center;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
    }

    .checkbox-label {
      margin-right: 10px;
      font-size: 1.2em;
      color: #333;
    }

    .language-selector {
      margin-bottom: 30px;
      display: flex;
      justify-content: center;
    }

    .language-selector select {
      padding: 10px;
      font-size: 1.1em;
      border-radius: 8px;
      border: 2px solid #ccc;
      transition: border-color 0.3s ease;
    }

    .language-selector select:focus {
      border-color: #2a5298;
      outline: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="language-selector">
      <select class="input-field" id="language" onchange="changeLanguage()">
        <option value="ku" selected>کوردی</option>
        <option value="ar">العربية</option>
        <option value="en">English</option>
      </select>
    </div>
    <h1 class="main-title" id="mainTitle"><i class="fas fa-solar-panel"></i> حیساباتی سیستەمی خۆر</h1>
    
    <!-- Single Phase Form (By Amps) -->
    <div class="form-section">
      <h2 class="form-title" id="formTitle"><i class="fas fa-plug"></i> سینگڵ فەیز - حیسابکردن بە ئەمپێر</h2>
      <div class="input-group">
        <label class="input-label" id="ampsLabel"><i class="fas fa-tachometer-alt"></i> ئەمپێر</label>
        <input type="number" class="input-field" id="amps" placeholder="ئەمپێر داخل بکە">
      </div>
      <div class="input-group">
        <label class="input-label" id="panelWattLabel"><i class="fas fa-bolt"></i> هێزی پانێل (وات)</label>
        <input type="number" class="input-field" id="panelWatt" placeholder="هێزی پانێل بە وات داخل بکە">
      </div>
      <div class="input-group">
        <label class="input-label" id="panelPriceLabel"><i class="fas fa-dollar-sign"></i> نرخی یەک پانێل (دۆلار)</label>
        <input type="number" class="input-field" id="panelPrice" placeholder="نرخی یەک پانێل بە دۆلار داخل بکە">
      </div>
      <div class="input-group">
        <label class="input-label" id="structureCostLabel"><i class="fas fa-tools"></i> بەستنی ئاسنگەری بۆ هەر پانێل (دۆلار)</label>
        <input type="number" class="input-field" id="structureCost" placeholder="نرخی بەستنی ئاسنگەری داخل بکە" value="30">
      </div>
      <div class="input-group">
        <label class="input-label" id="electricalCostLabel"><i class="fas fa-plug"></i> بەستنی کارەبایات بۆ هەر پانێل (دۆلار)</label>
        <input type="number" class="input-field" id="electricalCost" placeholder="نرخی بەستنی کارەبایات داخل بکە" value="15">
      </div>
      <div class="checkbox-group">
        <input type="checkbox" id="useBattery" checked>
        <label class="checkbox-label" id="useBatteryLabel" for="useBattery"><i class="fas fa-battery-half"></i> بەکارهێنانی باتری</label>
      </div>
      <div class="input-group" id="batteryOptions">
        <label class="input-label" id="batteryAmpsLabel"><i class="fas fa-tachometer-alt"></i> ئەمپێری باتری</label>
        <input type="number" class="input-field" id="batteryAmps" placeholder="ئەمپێری باتری داخل بکە" value="5">
        <label class="input-label" id="backupHoursLabel"><i class="fas fa-clock"></i> کاتژمێرەکانی پشتگیری (سەعات)</label>
        <input type="number" class="input-field" id="backupHours" placeholder="کاتژمێرەکان داخل بکە" value="8">
        <label class="input-label" id="batteryVoltageLabel"><i class="fas fa-battery-half"></i> فۆڵتاژی سیستەمی باتری</label>
        <select class="input-field" id="batteryVoltage">
          <option value="12">12V</option>
          <option value="24">24V</option>
          <option value="48" selected>48V</option>
        </select>
      </div>
      <button class="calculate-btn" id="calculateButton" onclick="calculateByAmps()"><i class="fas fa-calculator"></i> حیسابکردن</button>
    </div>

    <!-- Results Section -->
    <div class="results-section" id="results"></div>

    <!-- Download PDF Button -->
    <div class="download-section" id="downloadSection" style="display: none;">
      <button class="download-btn" id="downloadButton"><i class="fas fa-download"></i> داگرتنی PDF</button>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    // Language translations
    const translations = {
      ku: {
        pageTitle: "حیساباتی سیستەمی خۆر",
        languageLabel: "زمان هەڵبژێرە",
        mainTitle: "حیساباتی سیستەمی خۆر",
        formTitle: "سینگڵ فەیز - حیسابکردن بە ئەمپێر",
        ampsLabel: "ئەمپێر",
        ampsPlaceholder: "ئەمپێر داخل بکە",
        panelWattLabel: "هێزی پانێل (وات)",
        panelWattPlaceholder: "هێزی پانێل بە وات داخل بکە",
        panelPriceLabel: "نرخی یەک پانێل (دۆلار)",
        panelPricePlaceholder: "نرخی یەک پانێل بە دۆلار داخل بکە",
        structureCostLabel: "بەستنی ئاسنگەری بۆ هەر پانێل (دۆلار)",
        structureCostPlaceholder: "نرخی بەستنی ئاسنگەری داخل بکە",
        electricalCostLabel: "بەستنی کارەبایات بۆ هەر پانێل (دۆلار)",
        electricalCostPlaceholder: "نرخی بەستنی کارەبایات داخل بکە",
        useBatteryLabel: "بەکارهێنانی باتری",
        batteryAmpsLabel: "ئەمپێری باتری",
        batteryAmpsPlaceholder: "ئەمپێری باتری داخل بکە",
        backupHoursLabel: "کاتژمێرەکانی پشتگیری (سەعات)",
        backupHoursPlaceholder: "کاتژمێرەکان داخل بکە",
        batteryVoltageLabel: "فۆڵتاژی سیستەمی باتری",
        calculateButton: "حیسابکردن",
        downloadButton: "داگرتنی PDF",
        resultsTitle: "ئەنجامەکانی سینگڵ فەیز",
        inverterPowerLabel: "هێزی ئینڤێرتەر",
        ampsResultLabel: "ئەمپێر",
        panelCountLabel: "ژمارەی پانێلەکان",
        panelTotalPriceLabel: "کۆی نرخی پانێلەکان",
        structureCostLabel: "بەستنی ئاسنگەری",
        electricalCostLabel: "بەستنی کارەبایات",
        totalCostLabel: "کۆی گشتی نرخەکان",
        inverterSuggestionsHeader: "پێشنیارەکان بۆ {0} kW:",
        noInverterWarning: "هیچ ئینڤێرتەرێک لە لیستی قەبارەکاندا گونجاو نییە بۆ {0} kW.",
        batterySuggestionsHeader: "پێشنیاری باتری بۆ {0} kWh:",
        batterySuggestion: "1 باتری {0} kWh = {1}$ (پشتگیری: {2} کاتژمێر، {3} Ah)",
        batteryWarning: "تێبینی: یەک باتری {0} kWh تەنها {1} کاتژمێر پشتگیری دەدات بەجای {2} کاتژمێر.",
        noBatteryWarning: "باتری بەکارنەهێنراوە.",
        errorInvalidInput: "تکایە ژمارەیەکی دروست و نەرێ داخل بکە!",
        errorBatteryInput: "تکایە ئەمپێری باتری، کاتژمێرەکان و فۆڵتاژی باتری بە دروستی داخل بکە!",
        resultsPDFTitle: "ئەنجامەکانی سینگڵ فەیز - حیسابکردن بە ئەمپێر"
      },
      ar: {
        pageTitle: "حسابات نظام الطاقة الشمسية",
        languageLabel: "اختر اللغة",
        mainTitle: "حسابات نظام الطاقة الشمسية",
        formTitle: "مرحلة واحدة - الحساب بالأمبير",
        ampsLabel: "الأمبير",
        ampsPlaceholder: "أدخل الأمبير",
        panelWattLabel: "قدرة اللوح (واط)",
        panelWattPlaceholder: "أدخل قدرة اللوح بالواط",
        panelPriceLabel: "سعر اللوح الواحد (دولار)",
        panelPricePlaceholder: "أدخل سعر اللوح الواحد بالدولار",
        structureCostLabel: "تكلفة الهيكل لكل لوح (دولار)",
        structureCostPlaceholder: "أدخل تكلفة الهيكل",
        electricalCostLabel: "تكلفة التوصيلات الكهربائية لكل لوح (دولار)",
        electricalCostPlaceholder: "أدخل تكلفة التوصيلات الكهربائية",
        useBatteryLabel: "استخدام بطارية",
        batteryAmpsLabel: "أمبير البطارية",
        batteryAmpsPlaceholder: "أدخل أمبير البطارية",
        backupHoursLabel: "ساعات الدعم",
        backupHoursPlaceholder: "أدخل عدد الساعات",
        batteryVoltageLabel: "جهد نظام البطارية",
        calculateButton: "حساب",
        downloadButton: "تنزيل PDF",
        resultsTitle: "نتائج المرحلة الواحدة",
        inverterPowerLabel: "قدرة العاكس",
        ampsResultLabel: "الأمبير",
        panelCountLabel: "عدد الألواح",
        panelTotalPriceLabel: "إجمالي سعر الألواح",
        structureCostLabel: "تكلفة الهيكل",
        electricalCostLabel: "تكلفة التوصيلات الكهربائية",
        totalCostLabel: "إجمالي التكلفة",
        inverterSuggestionsHeader: "الاقتراحات لـ {0} كيلوواط:",
        noInverterWarning: "لا يوجد عاكس مناسب في قائمة الأحجام لـ {0} كيلوواط.",
        batterySuggestionsHeader: "اقتراح البطارية لـ {0} كيلوواط ساعة:",
        batterySuggestion: "1 بطارية {0} كيلوواط ساعة = {1}$ (الدعم: {2} ساعة، {3} أمبير ساعة)",
        batteryWarning: "ملاحظة: بطارية واحدة {0} كيلوواط ساعة تدعم فقط {1} ساعة بدلاً من {2} ساعة.",
        noBatteryWarning: "لم يتم استخدام بطارية.",
        errorInvalidInput: "الرجاء إدخال أرقام صحيحة وغير سالبة!",
        errorBatteryInput: "الرجاء إدخال أمبير البطارية، ساعات الدعم وجهد البطارية بشكل صحيح!",
        resultsPDFTitle: "نتائج المرحلة الواحدة - الحساب بالأمبير"
      },
      en: {
        pageTitle: "Solar System Calculator",
        languageLabel: "Select Language",
        mainTitle: "Solar System Calculator",
        formTitle: "Single Phase - Calculation by Amps",
        ampsLabel: "Amps",
        ampsPlaceholder: "Enter Amps",
        panelWattLabel: "Panel Power (Watts)",
        panelWattPlaceholder: "Enter Panel Power in Watts",
        panelPriceLabel: "Price per Panel (USD)",
        panelPricePlaceholder: "Enter Price per Panel in USD",
        structureCostLabel: "Structure Cost per Panel (USD)",
        structureCostPlaceholder: "Enter Structure Cost",
        electricalCostLabel: "Electrical Connections Cost per Panel (USD)",
        electricalCostPlaceholder: "Enter Electrical Connections Cost",
        useBatteryLabel: "Use Battery",
        batteryAmpsLabel: "Battery Amps",
        batteryAmpsPlaceholder: "Enter Battery Amps",
        backupHoursLabel: "Backup Hours",
        backupHoursPlaceholder: "Enter Number of Hours",
        batteryVoltageLabel: "Battery System Voltage",
        calculateButton: "Calculate",
        downloadButton: "Download PDF",
        resultsTitle: "Single Phase Results",
        inverterPowerLabel: "Inverter Power",
        ampsResultLabel: "Amps",
        panelCountLabel: "Number of Panels",
        panelTotalPriceLabel: "Total Panels Price",
        structureCostLabel: "Structure Cost",
        electricalCostLabel: "Electrical Connections Cost",
        totalCostLabel: "Total Cost",
        inverterSuggestionsHeader: "Suggestions for {0} kW:",
        noInverterWarning: "No suitable inverter found in the size list for {0} kW.",
        batterySuggestionsHeader: "Battery Suggestion for {0} kWh:",
        batterySuggestion: "1 Battery {0} kWh = {1}$ (Backup: {2} hours, {3} Ah)",
        batteryWarning: "Note: One {0} kWh battery supports only {1} hours instead of {2} hours.",
        noBatteryWarning: "Battery not used.",
        errorInvalidInput: "Please enter valid and non-negative numbers!",
        errorBatteryInput: "Please enter battery amps, backup hours, and battery voltage correctly!",
        resultsPDFTitle: "Single Phase Results - Calculation by Amps"
      }
    };

    // Change language
    function changeLanguage() {
      const lang = document.getElementById("language").value;
      const t = translations[lang];
      document.getElementById("pageTitle").innerText = t.pageTitle;
      document.getElementById("languageLabel").innerText = t.languageLabel;
      document.getElementById("mainTitle").innerText = t.mainTitle;
      document.getElementById("formTitle").innerText = t.formTitle;
      document.getElementById("ampsLabel").innerText = t.ampsLabel;
      document.getElementById("amps").placeholder = t.ampsPlaceholder;
      document.getElementById("panelWattLabel").innerText = t.panelWattLabel;
      document.getElementById("panelWatt").placeholder = t.panelWattPlaceholder;
      document.getElementById("panelPriceLabel").innerText = t.panelPriceLabel;
      document.getElementById("panelPrice").placeholder = t.panelPricePlaceholder;
      document.getElementById("structureCostLabel").innerText = t.structureCostLabel;
      document.getElementById("structureCost").placeholder = t.structureCostPlaceholder;
      document.getElementById("electricalCostLabel").innerText = t.electricalCostLabel;
      document.getElementById("electricalCost").placeholder = t.electricalCostPlaceholder;
      document.getElementById("useBatteryLabel").innerText = t.useBatteryLabel;
      document.getElementById("batteryAmpsLabel").innerText = t.batteryAmpsLabel;
      document.getElementById("batteryAmps").placeholder = t.batteryAmpsPlaceholder;
      document.getElementById("backupHoursLabel").innerText = t.backupHoursLabel;
      document.getElementById("backupHours").placeholder = t.backupHoursPlaceholder;
      document.getElementById("batteryVoltageLabel").innerText = t.batteryVoltageLabel;
      document.getElementById("calculateButton").innerText = t.calculateButton;
      document.getElementById("downloadButton").innerText = t.downloadButton;

      // Update direction for English
      document.body.style.direction = lang === "en" ? "ltr" : "rtl";
      document.getElementById("mainTitle").innerHTML = `<i class="fas fa-solar-panel"></i> ${t.mainTitle}`;
      document.getElementById("formTitle").innerHTML = `<i class="fas fa-plug"></i> ${t.formTitle}`;
      document.getElementById("useBatteryLabel").innerHTML = `<i class="fas fa-battery-half"></i> ${t.useBatteryLabel}`;
      document.getElementById("ampsLabel").innerHTML = `<i class="fas fa-tachometer-alt"></i> ${t.ampsLabel}`;
      document.getElementById("panelWattLabel").innerHTML = `<i class="fas fa-bolt"></i> ${t.panelWattLabel}`;
      document.getElementById("panelPriceLabel").innerHTML = `<i class="fas fa-dollar-sign"></i> ${t.panelPriceLabel}`;
      document.getElementById("structureCostLabel").innerHTML = `<i class="fas fa-tools"></i> ${t.structureCostLabel}`;
      document.getElementById("electricalCostLabel").innerHTML = `<i class="fas fa-plug"></i> ${t.electricalCostLabel}`;
      document.getElementById("batteryAmpsLabel").innerHTML = `<i class="fas fa-tachometer-alt"></i> ${t.batteryAmpsLabel}`;
      document.getElementById("backupHoursLabel").innerHTML = `<i class="fas fa-clock"></i> ${t.backupHoursLabel}`;
      document.getElementById("batteryVoltageLabel").innerHTML = `<i class="fas fa-battery-half"></i> ${t.batteryVoltageLabel}`;
      document.getElementById("calculateButton").innerHTML = `<i class="fas fa-calculator"></i> ${t.calculateButton}`;
      document.getElementById("downloadButton").innerHTML = `<i class="fas fa-download"></i> ${t.downloadButton}`;
    }

    // Show/hide battery options based on checkbox
    function toggleBatteryOptions() {
      const useBattery = document.getElementById("useBattery").checked;
      document.getElementById("batteryOptions").style.display = useBattery ? "block" : "none";
    }

    // Initialize checkbox event listener
    document.getElementById("useBattery").addEventListener("change", toggleBatteryOptions);
    toggleBatteryOptions();

    // Show results and toggle PDF download button
    function showResults(html) {
      document.getElementById("results").innerHTML = html;
      document.getElementById("downloadSection").style.display = html.includes("results-section") ? "block" : "none";
    }

    // Suggest inverters based on total kW
    function suggestInverters(totalKW, lang) {
      const t = translations[lang];
      const inverterOptions = [
        { size: 3.2, price: 250 },
        { size: 4, price: 350 },
        { size: 6, price: 400 },
        { size: 8, price: 1265 },
        { size: 11, price: 845 }
      ];
      let suggestions = [];
      for (let inv of inverterOptions) {
        let count = Math.round(totalKW / inv.size);
        if (count > 0 && count <= 3 && Math.abs(count * inv.size - totalKW) <= 1) {
          suggestions.push({
            text: `${count} ${lang === "ku" ? "ئینڤێرتەری" : lang === "ar" ? "عاكس" : "inverter"} ${inv.size} ${lang === "ku" || lang === "ar" ? "kW" : "kW"} = ${count * inv.price}$`,
            totalPrice: count * inv.price
          });
        }
      }
      for (let inv of inverterOptions) {
        for (let count = 1; count <= 3; count++) {
          let total = count * inv.size;
          if (Math.abs(total - totalKW) <= 1 && total >= totalKW) {
            suggestions.push({
              text: `${count} ${lang === "ku" ? "ئینڤێرتەری" : lang === "ar" ? "عاكس" : "inverter"} ${inv.size} ${lang === "ku" || lang === "ar" ? "kW" : "kW"} = ${count * inv.price}$`,
              totalPrice: count * inv.price
            });
          }
        }
      }
      suggestions = [...new Set(suggestions.map(s => s.text))].map(text => ({
        text,
        totalPrice: suggestions.find(s => s.text === text).totalPrice
      }));

      const bestSuggestion = suggestions.length > 0
        ? suggestions.reduce((prev, curr) => (prev.totalPrice < curr.totalPrice ? prev : curr))
        : null;

      return {
        html: suggestions.length > 0
          ? `<div class="suggestions-box">
               <div class="suggestions-header">
                 <i class="fas fa-lightbulb"></i>
                 ${t.inverterSuggestionsHeader.replace("{0}", totalKW.toFixed(2))}
               </div>
               ${suggestions.map(s => `
                 <div class="suggestion-item">
                   <i class="fas fa-check-circle" style="color: #28a745;"></i>
                   ${s.text}
                 </div>
               `).join('')}
             </div>`
          : `<div class="warning-box">
               <div class="warning-header">
                 <i class="fas fa-exclamation-triangle"></i>
                 ${t.noInverterWarning.replace("{0}", totalKW.toFixed(2))}
               </div>
             </div>`,
        totalPrice: bestSuggestion ? bestSuggestion.totalPrice : 0
      };
    }

    // Suggest a single battery based on battery amps
    function suggestBatteries(batteryAmps, backupHours, batteryVoltage, lang) {
      const t = translations[lang];
      const batteryOptions = [
        { capacity: 5, price: 840 },
        { capacity: 10, price: 1400 },
        { capacity: 15, price: 1680 }
      ];
      const requiredKWh = (batteryAmps * batteryVoltage * backupHours) / 1000;
      let bestBattery = batteryOptions.find(b => b.capacity >= requiredKWh) || batteryOptions[batteryOptions.length - 1];
      let actualBackupHours = (bestBattery.capacity * 1000) / (batteryAmps * batteryVoltage);
      let totalAh = batteryAmps * backupHours;

      return {
        html: `<div class="suggestions-box">
                 <div class="suggestions-header">
                   <i class="fas fa-battery-half"></i>
                   ${t.batterySuggestionsHeader.replace("{0}", requiredKWh.toFixed(2))}
                 </div>
                 <div class="suggestion-item">
                   <i class="fas fa-check-circle" style="color: #28a745;"></i>
                   ${t.batterySuggestion
                     .replace("{0}", bestBattery.capacity)
                     .replace("{1}", bestBattery.price)
                     .replace("{2}", actualBackupHours.toFixed(2))
                     .replace("{3}", totalAh.toFixed(2))}
                 </div>
                 ${requiredKWh > bestBattery.capacity ? `
                   <div class="warning-box">
                     <div class="warning-header">
                       <i class="fas fa-exclamation-triangle"></i>
                       ${t.batteryWarning
                         .replace("{0}", bestBattery.capacity)
                         .replace("{1}", actualBackupHours.toFixed(2))
                         .replace("{2}", backupHours)}
                     </div>
                   </div>` : ''}
               </div>`,
        totalPrice: bestBattery.price,
        totalAh: totalAh
      };
    }

    // Calculate by amps
    function calculateByAmps() {
      const lang = document.getElementById("language").value;
      const t = translations[lang];
      let amps = parseFloat(document.getElementById("amps").value);
      let panelWatt = parseFloat(document.getElementById("panelWatt").value);
      let panelPrice = parseFloat(document.getElementById("panelPrice").value);
      let structureCostPerPanel = parseFloat(document.getElementById("structureCost").value);
      let electricalCostPerPanel = parseFloat(document.getElementById("electricalCost").value);
      let useBattery = document.getElementById("useBattery").checked;
      let batteryAmps = parseFloat(document.getElementById("batteryAmps").value);
      let backupHours = parseFloat(document.getElementById("backupHours").value);
      let batteryVoltage = parseFloat(document.getElementById("batteryVoltage").value);

      if (isNaN(amps) || isNaN(panelWatt) || isNaN(panelPrice) || isNaN(structureCostPerPanel) || isNaN(electricalCostPerPanel) || amps <= 0 || panelWatt <= 0 || panelPrice <= 0 || structureCostPerPanel < 0 || electricalCostPerPanel < 0) {
        showResults(`
          <div class="error-message">
            <i class="fas fa-exclamation-triangle"></i>
            ${t.errorInvalidInput}
          </div>
        `);
        return;
      }
      if (useBattery && (isNaN(batteryAmps) || isNaN(backupHours) || isNaN(batteryVoltage) || batteryAmps <= 0 || backupHours <= 0 || batteryVoltage <= 0)) {
        showResults(`
          <div class="error-message">
            <i class="fas fa-exclamation-triangle"></i>
            ${t.errorBatteryInput}
          </div>
        `);
        return;
      }

      let totalWatt = (amps / 0.8) * 230;
      let totalKW = totalWatt / 1000;
      let panelCount = Math.ceil(totalWatt / panelWatt);
      let panelTotalPrice = panelCount * panelPrice;
      let structureCost = panelCount * structureCostPerPanel;
      let electricalCost = panelCount * electricalCostPerPanel;
      let inverterSuggestion = suggestInverters(totalKW, lang);
      let batterySuggestion = useBattery ? suggestBatteries(batteryAmps, backupHours, batteryVoltage, lang) : { html: "", totalPrice: 0, totalAh: 0 };
      let totalCost = panelTotalPrice + structureCost + electricalCost + inverterSuggestion.totalPrice + batterySuggestion.totalPrice;

      showResults(`
        <div class="results-section">
          <div class="results-header">
            <div class="results-icon">
              <i class="fas fa-check-circle"></i>
            </div>
            <h3 class="results-title">${t.resultsTitle}</h3>
          </div>
          <div class="result-item">
            <div class="result-label"><i class="fas fa-microchip"></i> ${t.inverterPowerLabel}</div>
            <div class="result-value">${totalKW.toFixed(2)} kW</div>
          </div>
          <div class="result-item">
            <div class="result-label"><i class="fas fa-tachometer-alt"></i> ${t.ampsResultLabel}</div>
            <div class="result-value">${amps.toFixed(2)} A</div>
          </div>
          <div class="result-item">
            <div class="result-label"><i class="fas fa-solar-panel"></i> ${t.panelCountLabel}</div>
            <div class="result-value">${panelCount}</div>
          </div>
          <div class="result-item">
            <div class="result-label"><i class="fas fa-dollar-sign"></i> ${t.panelTotalPriceLabel}</div>
            <div class="result-value">${panelTotalPrice.toFixed(2)}$</div>
          </div>
          <div class="result-item">
            <div class="result-label"><i class="fas fa-tools"></i> ${t.structureCostLabel}</div>
            <div class="result-value">${structureCost.toFixed(2)}$</div>
          </div>
          <div class="result-item">
            <div class="result-label"><i class="fas fa-plug"></i> ${t.electricalCostLabel}</div>
            <div class="result-value">${electricalCost.toFixed(2)}$</div>
          </div>
          ${inverterSuggestion.html}
          ${useBattery ? batterySuggestion.html : `
            <div class="warning-box">
              <div class="warning-header">
                <i class="fas fa-exclamation-triangle"></i>
                ${t.noBatteryWarning}
              </div>
            </div>`}
          <div class="result-item">
            <div class="result-label"><i class="fas fa-dollar-sign"></i> ${t.totalCostLabel}</div>
            <div class="result-value">${totalCost.toFixed(2)}$</div>
          </div>
        </div>
      `);

      // Save results for PDF
      window.currentResults = {
        title: t.resultsPDFTitle,
        content: `
          ${t.inverterPowerLabel}: ${totalKW.toFixed(2)} kW
          ${t.ampsResultLabel}: ${amps.toFixed(2)} A
          ${t.panelCountLabel}: ${panelCount}
          ${t.panelTotalPriceLabel}: ${panelTotalPrice.toFixed(2)}$
          ${t.structureCostLabel}: ${structureCost.toFixed(2)}$
          ${t.electricalCostLabel}: ${electricalCost.toFixed(2)}$
          ${inverterSuggestion.html.replace(/<[^>]+>/g, '')}
          ${useBattery ? batterySuggestion.html.replace(/<[^>]+>/g, '') : t.noBatteryWarning}
          ${t.totalCostLabel}: ${totalCost.toFixed(2)}$
        `,
        lang: lang
      };
    }

    // Download PDF with Amiri font
    function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({
        orientation: 'portrait',
        unit: 'mm',
        format: 'a4'
      });

      const lang = window.currentResults.lang;
      const font = lang === "en" ? "Helvetica" : "Amiri";
      
      // Add Amiri font (you need to include the base64 font or host it locally)
      const amiriFont = 'data:application/font-ttf;base64,...'; // Replace with actual base64 of Amiri-Regular.ttf
      doc.addFileToVFS('Amiri-Regular.ttf', amiriFont);
      doc.addFont('Amiri-Regular.ttf', 'Amiri', 'normal');

      doc.setFont(font, "normal");
      doc.setFontSize(16);

      // Split text for proper wrapping
      const title = window.currentResults.title;
      const content = window.currentResults.content.split('\n').map(line => line.trim()).filter(line => line);

      // Add title
      doc.text(title, lang === "en" ? 10 : 190, 10, { align: lang === "en" ? "left" : "right" });

      // Add content with line breaks
      doc.setFontSize(12);
      let y = 20;
      content.forEach(line => {
        doc.text(line, lang === "en" ? 10 : 190, y, { align: lang === "en" ? "left" : "right" });
        y += 7;
      });

      doc.save("Solar_System_Calculation.pdf");
    }
  </script>
</body>
</html>
